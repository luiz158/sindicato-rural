<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="../_template.xhtml">

	<ui:define name="conteudo">

		<p:breadCrumb>
			<p:menuitem value="Home" url="/faces/index.xhtml" />
			<p:menuitem value="Financeiro" url="#" />
			<p:menuitem value="Gravar débito do cliente" url="#" />
		</p:breadCrumb>

		<h:form>
			<p:growl id="growl" showDetail="true" life="15000" />
			<p:fieldset legend="Informações basicas" style="margin-top:15px;">
				<p:panelGrid styleClass="panelForm"
					style="width:80%;margin-top:20px;">

					<p:row>
						<p:column styleClass="colLabel" style="width:250px;">
							<p:outputLabel value="Selecione o cliente" />
						</p:column>
						<p:column styleClass="colInput">
							<p:selectOneMenu value="#{gravarDebitoBean.debito.cliente}"
								converter="ClienteConverter" effect="fade" filter="true"
								id="clientes" label="Selecione o cliente" required="true"
								requiredMessage="Cliente:">

								<f:selectItems value="#{gravarDebitoBean.clientes}" var="cli"
									itemValue="#{cli}" itemLabel="#{cli.nome}" />

								<p:ajax update="situacao" event="change"
									listener="#{gravarDebitoBean.selecionaCliente}" />

							</p:selectOneMenu>

							<h:panelGroup layout="div"
								rendered="#{gravarDebitoBean.situacaoCliente != null}"
								id="situacao">
								<p:graphicImage
									rendered="#{gravarDebitoBean.situacaoCliente.atrasado}"
									library="imagens" name="close-delete.png" />
								<p:graphicImage
									rendered="#{!gravarDebitoBean.situacaoCliente.atrasado}"
									library="imagens" name="check.png" />
							</h:panelGroup>

						</p:column>

					</p:row>

					<p:row>
						<p:column styleClass="colLabel" style="width:250px;">
							<p:outputLabel value="Data base:" />
						</p:column>
						<p:column styleClass="colInput">
							<p:calendar onkeyup="mascara(this,data)"
								value="#{gravarDebitoBean.debito.dataBase}" pattern="dd/MM/yyyy"
								styleClass="date" converter="CalendarConverter">

							</p:calendar>
						</p:column>
					</p:row>



				</p:panelGrid>
			</p:fieldset>

			<p:fieldset legend="Serviços" style="margin-top:15px;">
				<p:commandButton id="effectsDialogButton" value="Adicionar serviço"
					onclick="PF('dlg3').show();" type="button" style="height:50px;width:200px;margin-bottom:15px;" />

				<p:dialog header="Adicionar serviço" widgetVar="dlg3"
					resizable="true" showEffect="fade" hideEffect="fade" height="150"
					width="350">
					<p:panelGrid styleClass="panelForm" style="width:100%;" id="formServico">

						<p:row>
							<p:column styleClass="colLabel" style="">
								<p:outputLabel value="Serviço" />
							</p:column>
							<p:column styleClass="colInput">
								<p:selectOneMenu
									value="#{gravarDebitoBean.debitoServico.servico}"
									converter="ServicoConverter" effect="fade" filter="true">
									<f:selectItems value="#{gravarDebitoBean.servicos}" var="ser"
										itemValue="#{ser}" itemLabel="#{ser.descricao}" />
								</p:selectOneMenu>
							</p:column>
						</p:row>
						<p:row>
							<p:column styleClass="colLabel">
								<p:outputLabel value="Valor" />
							</p:column>
							<p:column styleClass="colInput">
								<p:inputText onkeypress="mascara(this,moeda)"
									value="#{gravarDebitoBean.debitoServico.valor}" >
									<f:convertNumber pattern="#,##0.00" type="currency"
										locale="pt_BR" />
								</p:inputText>
							</p:column>
						</p:row>
						<p:row>
							<p:column styleClass="colLabel" colspan="2">
								<p:commandButton value="Adicionar"
									actionListener="#{gravarDebitoBean.salvarServico}"
									oncomplete="PF('dlg3').hide();" update="servicos,formServico" />
							</p:column>
						</p:row>
					</p:panelGrid>
				</p:dialog>

				<p:dataTable var="debito" id="servicos"
					emptyMessage="Nenhum serviço cadastrado"
					value="#{gravarDebitoBean.debito.debitoServicos}">

					<p:column headerText="Serviço">
						<p:outputLabel value="#{debito.servico.descricao}" />
					</p:column>
					<p:column headerText="Valor">
						<p:outputLabel value="#{debito.valor}" >
							<f:convertNumber locale="pt_BR" type="currency"
									currencySymbol="R$ " />
						</p:outputLabel>
					</p:column>
					<p:column headerText="" width="45">
						<p:commandButton value="Excluir"
							action="#{gravarDebitoBean.removerServico(debito)}"
							update="servicos" />
					</p:column>
				</p:dataTable>


			</p:fieldset>

			<div class="container-action">
				<p:commandButton action="#{gravarDebitoBean.salvar}" update="@form"
					value="Salvar alterações" style="width:200px;height:50px;" />
			</div>




		</h:form>

	</ui:define>
</ui:composition>

</html>